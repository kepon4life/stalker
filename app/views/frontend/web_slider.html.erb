<% @title="Stalker - Web Slider" %>
<link href='http://fonts.googleapis.com/css?family=Anton' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Economica' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Pathway+Gothic+One' rel='stylesheet' type='text/css'>
<% content_for :stylesheet_includes do %>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css">
<%= stylesheet_link_tag '/frontend/css/slider.css'  %>
<%= stylesheet_link_tag '/frontend/css/web_slider.css'  %>

<%= stylesheet_link_tag '/frontend/css/slider-range-dreams.css'  %>

<% end %>
<% content_for :javascript_includes_in_head do %>
  <script>window["_GOOG_TRANS_EXT_VER"] = "1";</script>
<% end %>
<% content_for :javascript_includes do %>

    <%= javascript_include_tag "/frontend/js/libs/three.min.js" %>

    <%= javascript_include_tag "/frontend/js/libs/stats.min.js" %>
    
    <!--<script src="http://yui.yahooapis.com/3.9.0/build/yui/yui-min.js"></script>-->
    <%= javascript_include_tag "/frontend/js/libs/yui3/build/yui/yui-min.js" %>
    <%= javascript_include_tag "/frontend/js/libs/inputex/src/loader.js" %>

    <%= javascript_include_tag "/frontend/js/libs/enscroll-0.4.2.min.js"%>
    <%= javascript_include_tag "/frontend/js/libs/waypoints.min.js"%>
    <script src="http://js.pusher.com/1.12/pusher.min.js"></script>

    <%= javascript_include_tag "/frontend/js/pusher.js" %>
    <%= javascript_include_tag "/frontend/js/slider.js" %>


    <script type="text/javascript">
        var events = new Array();
        <% @events.each do |event| %>
            events.push({name:"<%= event.name %>", id: <%= event.id %>, image: "<%= event.image_file_name %>", description: "<%= event.description %>", address: "<%= event.address %>"});
        <% end %>
    </script>

    <%= javascript_include_tag "/frontend/js/web_slider.js" %>

    <script type="text/javascript">
    var id_dream = null;
    var dream_called_in_moderation = null;
    var dream_called_valid = null;
    var url_to_service = window.location.origin + "/services/dreamsvalidated";
    <% if @id_dream != nil %>
        dream_called_in_moderation = <%= @dream_called_in_moderation %>
        dream_called_valid = <%= @dream_called_valid %>
        id_dream = <%= @id_dream %>
        <% if !@dream_called_valid %>
            url_to_service = window.location.origin + "/services/dreamsvalidated?requested=" + <%= @id_dream %>;
        <% end %>
        alert("WEB SLIDER Appeler avec un rêve en paramètre : \n"
          + "Id : " + id_dream + "\n"
          + "Dream is not moderated : " + dream_called_in_moderation + "\n"
          + "Dream is valid : " + dream_called_valid);
    <% end %>

        

        YUI_config.groups.inputex.base = "frontend/js/libs/inputex/src/";
        YUI_config.groups.inputex.filter = "raw";
        YUI_config.stalkerbase = "frontend/";

        YUI().use("io", "json", "widget", "base", "event-resize",
                "inputex-string", "inputex-select", "inputex-group",
                "inputex-list", "inputex-combine", "inputex-checkbox",
                "transition",
                "stalker-slider", "stalker-webslider", "stalker-pusher",
            function(Y) {

            Y.on("domready", function() {

                if (Y.hasWebgl()) {
                    Y.one('#welcome').hide();
                    var hash = window.location.hash,
                        slider = new Y.Stalker.WebSlider({
                            textureWidth: (hash.length > 1) ? +hash.substring(1) : 256, // 64, 128, 256, 512, 1024, 2048
                            particleSize: 13, // default: 10
                            slideshowRunning: true,
                            trackCam: true,
                            showLegend: true,
                            showQr: false,
                            customStart: id_dream
                        });
                    slider.render();                                            // Render slider
                    slider.loadAlbumFromService(url_to_service);// Load album

                } else {
                    Y.one('#welcome').hide();
                    $("#nowebgl").slider_web(id_dream,url_to_service);
                }
            });
        });
    </script>

<% end %>


<div id="fb-root"></div>
<script>
  window.fbAsyncInit = function() {
    // init the FB JS SDK
    FB.init({
      appId      : '802550783217888',                        // App ID from the app dashboardcomms
      status     : true,                                 // Check Facebook Login status
      xfbml      : true                                  // Look for social plugins on the page
    });

    // Additional initialization code such as adding Event Listeners goes here
  };

  // Load the SDK asynchronously
  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/all.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
<div class="overlay" id="welcome">
    <div class="wrap">
        <div class="messagebox">

            <p class="loading" style="">Loading...</p>

            <p class="fail" style="display: none; ">
                Unfortunately, it seems that your system is currently unable to run WebGL required for this experiment. You may try installing the latest version of <a href="https://www.google.com/chrome">Chrome</a> or <a href="http://www.getfirefox.net/">Firefox</a> browsers. Visit this <a href="http://www.khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">page</a> for more details on obtaining WebGL.
            </p>

        </div>
    </div>
</div>
<img id="stalkerlogo" alt="Expo stalker" src="frontend/img/logo_stalker.png">
<img id="maisonlogo" alt="Maison d'ailleurs" src="frontend/img/logo-maison.png">
<div id="nowebgl"></div>